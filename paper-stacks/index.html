<!DOCTYPE html>
<html lang="en">
    <head> 
    <meta charset = "UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title> Paper Stacks</title> 
        <link href="../styles/paper-stacks-style.css" rel="stylesheet" />
    </head>
    <body>
        <button id="peek-left" class="stack-button"></button>
        <button id="peek-right" class="stack-button"></button>
        <img id="left-stack-image" style="display: none; max-width: 300px;">
        <div id="image-modal" class="modal">
            <div class="modal-content">
                <div id="loading-message" style="display: none;">Please wait... the server takes a moment to spin up</div>
                <img id="stack-image" src="">
                <br>
                <button id="download-btn" class="modal-button">Download</button>
                <button id="return-btn" class="modal-button">Return</button>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const backendUrl = 'https://tino-website.onrender.com';
                const peekLeftButton = document.getElementById('peek-left');
                const peekRightButton = document.getElementById('peek-right');
                const modal = document.getElementById('image-modal');
                const modalImage = document.getElementById('stack-image');

                let loadingTimeout;

                peekLeftButton.addEventListener('click', async () => {

                    loadingTimeout = setTimeout(() => {
                        document.getElementById('loading-message').style.display = 'block';
                        }, 1000);
                    
                    const res = await fetch(`${backendUrl}/stack/left/top`, { mode: 'cors' });
                    clearTimeout(loadingTimeout);
                    document.getElementById('loading-message').style.display = 'none';

                    const data = await res.json();
                    if (data.top) {
                        modalImage.src = data.top;
                        modal.style.display = 'flex';
                        modalImage.style.display = 'block';
                    }
                });

                peekRightButton.addEventListener('click', async () => {
                    const res = await fetch(`${backendUrl}/stack/right/top`, { mode: 'cors' });
                    const data = await res.json();
                    if (data.top) {
                        modalImage.src = data.top;
                        modal.style.display = 'flex';
                        modalImage.style.display = 'block';
                    }
                });
            });
        </script>
    </body></html>